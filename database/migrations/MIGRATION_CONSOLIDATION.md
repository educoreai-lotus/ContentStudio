# ××™×–×•×’ ××™×’×¨×¦×™×•×ª - Migration Consolidation

## âœ… ××” × ×¢×©×”?

×©×™×œ×‘× ×• ××ª ×›×œ ×”××™×’×¨×¦×™×•×ª ×œ××™×’×¨×¦×™×” ××—×ª ×¨××©×™×ª (`migration.sql`) ×›×“×™ ×©×›×œ ×”××‘× ×” ×©×œ ××¡×“ ×”× ×ª×•× ×™× ×™×”×™×” ×‘×§×•×‘×¥ ××—×“.

## ğŸ“‹ ×§×‘×¦×™× ×©×©×•×œ×‘×•

### 1. `add_language_stats.sql` â†’ ×©×•×œ×‘ ×‘-`migration.sql`
**××™×§×•× ×‘×§×•×‘×¥ ×”×¨××©×™:** ×©×•×¨×•×ª 204-276

**××” × ×›×œ×œ:**
- âœ… ×˜×‘×œ×ª `language_stats`
- âœ… ××™× ×“×§×¡×™× ×œ×˜×‘×œ×”
- âœ… ×”×›× ×¡×ª ×©×¤×•×ª ××•×’×“×¨×•×ª ××¨××© (en, he, ar)
- âœ… ×¤×•× ×§×¦×™×” `update_language_stats()`
- âœ… ×¤×•× ×§×¦×™×” `recalculate_language_frequency()`

### 2. `add_cleanup_functions.sql` â†’ ×©×•×œ×‘ ×‘-`migration.sql`
**××™×§×•× ×‘×§×•×‘×¥ ×”×¨××©×™:** ×©×•×¨×•×ª 278-334

**××” × ×›×œ×œ:**
- âœ… ×¤×•× ×§×¦×™×” `get_non_frequent_languages()`
- âœ… ×¤×•× ×§×¦×™×” `mark_language_for_cleanup()`
- âœ… View `language_cleanup_candidates`

## ğŸ“Š ××‘× ×” ×”××™×’×¨×¦×™×” ×”×××•×—×“×ª

```
migration.sql
â”œâ”€â”€ ENUM Types (content_status, TemplateType)
â”œâ”€â”€ Table 1: trainer_courses
â”œâ”€â”€ Table 2: templates
â”œâ”€â”€ Table 3: topics
â”œâ”€â”€ Table 4: content_types (Lookup Table)
â”œâ”€â”€ Table 5: generation_methods (Lookup Table)
â”œâ”€â”€ Table 6: content
â”œâ”€â”€ Table 7: content_history
â”œâ”€â”€ Table 8: language_stats â† × ×•×¡×£!
â”œâ”€â”€ Functions:
â”‚   â”œâ”€â”€ update_language_stats() â† × ×•×¡×£!
â”‚   â”œâ”€â”€ recalculate_language_frequency() â† × ×•×¡×£!
â”‚   â”œâ”€â”€ get_non_frequent_languages() â† × ×•×¡×£!
â”‚   â””â”€â”€ mark_language_for_cleanup() â† × ×•×¡×£!
â”œâ”€â”€ View: language_cleanup_candidates â† × ×•×¡×£!
â””â”€â”€ Comments and Documentation
```

## ğŸ¯ ×œ××” ×–×” ×—×©×•×‘?

### ×™×ª×¨×•× ×•×ª:
1. **××™×’×¨×¦×™×” ××—×ª** - ×›×œ ×”××‘× ×” ×‘××§×•× ××—×“
2. **×§×œ ×œ×ª×—×–×§** - ×œ× ×¦×¨×™×š ×œ×—×¤×© ×‘×§×‘×¦×™× ×©×•× ×™×
3. **×¤×¨×™×¡×” ×§×œ×”** - ×¨×§ ×§×•×‘×¥ ××—×“ ×œ×”×¨×™×¥
4. **×¡×“×¨ × ×›×•×Ÿ** - ×”×˜×‘×œ××•×ª × ×•×¦×¨×•×ª ×‘×¡×“×¨ ×”× ×›×•×Ÿ (Foreign Keys)

### ×”×§×‘×¦×™× ×”× ×¤×¨×“×™×:
- `add_language_stats.sql` - ×¢×“×™×™×Ÿ ×§×™×™× (×œ× × ××—×§)
- `add_cleanup_functions.sql` - ×¢×“×™×™×Ÿ ×§×™×™× (×œ× × ××—×§)

**×œ××” ×œ×©××•×¨ ××•×ª×?**
- ×ª×™×¢×•×“ ×”×™×¡×˜×•×¨×™
- ××¤×©×¨ ×œ×”×¨×™×¥ ××•×ª× ×‘× ×¤×¨×“ ×× ×¦×¨×™×š
- ×¢×“×›×•× ×™× ×¢×ª×™×“×™×™×

## ğŸš€ ×©×™××•×©

### ×¤×¨×™×¡×” ×¨××©×•× ×” (Fresh Database)
```sql
-- ×”×¨×¥ ×¨×§ ××ª migration.sql
-- ×–×” ×™×›×œ×•×œ ×”×›×œ, ×›×•×œ×œ language_stats
```

### ×¢×“×›×•×Ÿ ×œ××¡×“ ×§×™×™×
×× ×›×‘×¨ ×™×© ×œ×š ××¡×“ × ×ª×•× ×™×:

**××¤×©×¨×•×ª 1: ×”×¨×¥ ××ª ×”×§×‘×¦×™× ×”× ×¤×¨×“×™×**
```sql
-- ×× ××™×Ÿ ×œ×š language_stats
\i database/migrations/add_language_stats.sql

-- ×× ××™×Ÿ ×œ×š cleanup functions
\i database/migrations/add_cleanup_functions.sql
```

**××¤×©×¨×•×ª 2: ×”×¨×¥ ×¨×§ ××ª ×”×—×œ×§×™× ×”×—×¡×¨×™×**
```sql
-- ×¨×§ ××ª ×”×—×œ×§ ×”×¨×œ×•×•× ×˜×™ ×-migration.sql
```

## âš ï¸ ×—×©×•×‘ ×œ×“×¢×ª

1. **×”××™×’×¨×¦×™×” ×”×¨××©×™×ª** (`migration.sql`) ×›×•×œ×œ×ª ×”×›×œ ×›×¢×ª
2. **×”×§×‘×¦×™× ×”× ×¤×¨×“×™×** × ×©××¨×™× ×œ×ª×™×¢×•×“ ×•×œ×©×™××•×© ×¢×ª×™×“×™
3. **×¡×“×¨ ×”×”×¨×¦×”** ×—×©×•×‘ - ×”×˜×‘×œ××•×ª ×ª×œ×•×™×•×ª ×–×• ×‘×–×•
4. **Foreign Keys** - `language_stats` ×œ× ×ª×œ×•×™ ×‘×˜×‘×œ××•×ª ××—×¨×•×ª, ××– ×”×•× ×™×›×•×œ ×œ×”×™×•×ª ×‘×¡×•×£

## âœ… ×¡×˜×˜×•×¡

- [x] `language_stats` table ×©×•×œ×‘ ×‘-`migration.sql`
- [x] ×›×œ ×”×¤×•× ×§×¦×™×•×ª ×©×•×œ×‘×•
- [x] View ×©×•×œ×‘
- [x] ××™× ×“×§×¡×™× ×©×•×œ×‘×•
- [x] ×©×¤×•×ª ××•×’×“×¨×•×ª ××¨××© × ×•×¡×¤×•
- [x] Comments ×¢×•×“×›× ×•

## ğŸ“ ×”×¢×¨×•×ª

×”×§×‘×¦×™× `add_language_stats.sql` ×•-`add_cleanup_functions.sql` × ×©××¨×™× ×‘×§×•×“ ×œ××§×¨×” ×©×ª×¨×¦×” ×œ×”×¨×™×¥ ××•×ª× ×‘× ×¤×¨×“, ××‘×œ **×”××™×’×¨×¦×™×” ×”×¨××©×™×ª ×›×•×œ×œ×ª ×”×›×œ** ×•×–×” ××” ×©×¦×¨×™×š ×œ×”×¨×™×¥ ×‘×¤×¨×™×¡×” ×¨××©×•× ×”.

---

**×¢×•×“×›×Ÿ:** 2025-01-22  
**×¡×˜×˜×•×¡:** âœ… ××•×›×Ÿ ×œ×¤×¨×™×¡×”

